---
title: "Interactive data visualization on the web using R"
venue: "Iowa State University"
type: "PhD Seminar"
recording: "none"
output:
  ioslides_presentation:
    transition: default
    widescreen: true
    standalone: false
css:
  styles.css
date: "2016-12-12 <br /> <br /> This work is released under <a href='https://github.com/cpsievert/talks/blob/gh-pages/LICENSE'>Creative Commons</a>"
author: "Carson Sievert"
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  echo = FALSE,
  fig.width = 10,
  fig.height = 4,
  comment = "#>",
  collapse = TRUE
)
```

## Bio

* Teaching Assistant, <b>Iowa State University</b> (2011-2015)
* M.S. in Statistics, <b>Iowa State University</b> (2013)
* Internships with AT&T (2013) and Google (2014)
* Software Developer, <b>plotly</b> (2015 - Present)
* Research Assistant, <b>Monash University</b> (Sept 2015 - June 2016)

---

<div align="center">
  <img src="me.jpg" width="550" height="600" />
</div>

## Future plans

#### Freelance software developer & data scientist
<p></p>
* My clients already include: plotly, NOAA, Phronesis
* In addition to developing <b>plotly</b>, I plan on delivering "data products" (e.g. interactive web apps, dynamic reports/documents, etc.)
* Businesses already building products around <b>plotly</b>: [Omni Analytics](https://omnianalytics.io/), [TCBD Analytics](http://tcbanalytics.com/)


## Why interactive/dynamic graphics?

* Why interactive/dynamic graphics for <b>presentation</b>?
    * Enhances knowledge transfer in some way (see [New York Times](http://www.nytimes.com/interactive/2015/us/year-in-interactive-storytelling.html), [USA Today](http://www.usatoday.com/topic/E01C4890-85A2-4E0B-A3DD-58BD88E71251/interactive-graphics/), [538](http://fivethirtyeight.com/features/gun-deaths/), [setosa](http://setosa.io/))
* Why interactive/dynamic graphics for <b>exploration</b>?
    * Identify structure that might otherwise go missing ([Tukey 1972](http://stat-graphics.org/movies/prim9.html))
    * Find Gestalt, pose queries, & make comparisons ([Cook, Buja, & Swayne 2007](https://www.jstor.org/stable/1390754))
    * Explore, understand, & diagnose statistical model fit(s) ([Wickham, Cook, & Hofmann 2015](http://onlinelibrary.wiley.com/doi/10.1002/sam.11271/abstract)).
    * <b>Generate insights faster (iteration time is crucial!)</b>
    
* Why _web_ graphics?
    * simple to share, portable (web browser)
    * encourages composability

## 2016 Election Outcomes by County ([source](http://rpubs.com/dgrtwo/county-results))

```
     County |   State | TotalVotes| Clinton| Johnson| Stein| Trump| Population|    Area
    --------| --------| ----------|--------|--------|------|------|-----------|--------
1   autauga | alabama |      24661|   0.240|   0.022| 0.004| 0.734|      54571|  594.44
2   baldwin | alabama |      94090|   0.196|   0.026| 0.005| 0.774|     182265| 1589.78
3   barbour | alabama |      10390|   0.467|   0.009| 0.002| 0.523|      27457|  884.88
4      bibb | alabama |       8748|   0.214|   0.014| 0.002| 0.770|      22915|  622.58
5    blount | alabama |      25384|   0.085|   0.013| 0.004| 0.899|      57322|  644.78
6   bullock | alabama |       4701|   0.751|   0.005| 0.002| 0.242|      10914|  622.81
7    butler | alabama |       8685|   0.428|   0.007| 0.001| 0.563|      20947|  776.83
8   calhoun | alabama |      47376|   0.279|   0.024| 0.006| 0.692|     118572|  605.87
9  chambers | alabama |      13778|   0.418|   0.012| 0.003| 0.566|      34215|  596.53
10 cherokee | alabama |      10503|   0.145|   0.014| 0.002| 0.839|      25989|  553.70
# ... with 3,101 more rows
```

* Is there a relationship between population density and voting preference? 

---

<!-- Make movie? Original graph should be wider/shorter? -->

<iframe src = "votes.html" style="border: 0; position:absolute; top:0; left:0; right:0; bottom:0; width:100%; height:100%"></iframe>

---

<iframe src = "map.html" style="border: 0; position:absolute; top:0; left:0; right:0; bottom:0; width:100%; height:100%"></iframe>

---

<a href="election.mp4">
  <img src="election.png" width="1050" height="500" />
</a>

## Motivating interactivity with data analysis tasks

* Initial scatterplot revealed strange pattern in Stein votes and pop density.

* Interactive focusing (zoom/pan) helped reveal vote proportions are rounded to the thousands.

* Interactive identification (tooltip on mouse hover) helped reveal various details about counties.

* Linked brushing helped reveal a strong geographic pattern in counties with no Stein votes. After some Googling, I discovered [Stein was not on the ballot in these states](http://www.jill2016.com/ballot_access). 

* [Cook, Buja, & Swayne 2007](https://www.jstor.org/stable/1390754) -- propose a taxonomy of interaction (focusing, arranging, and linking views) motivated by common data analysis tasks (making comparisons, posing queries, and finding Gestalt).
    
## Finding Gestalt & posing queries

```{r}
library(plotly)
library(crosstalk)

d <- SharedData$new(txhousing, ~city)
p <- ggplot(d, aes(date, median, group = city)) + geom_line()
ggplotly(p, tooltip = "city", dynamicTicks = TRUE, height = 550, width = 1000) %>%
  rangeslider() %>%
  layout(
    margin = list(l = 50), 
    yaxis = list(title = "Median house price")
    ) %>%
  highlight("plotly_hover", "plotly_deselect")
```

## Querying missing values

<iframe src = "missing.html" style="border: 0; position:absolute; top:0; left:0; right:0; bottom:0; width:100%; height:100%"></iframe>
    
## Making comparisons

TODO: eechidna?

## Brushing animated views

TODO: gapminder example?


## The problem with exploratory web graphics

* Web graphics are useful for conveying information (viz is _known_),  but often impractical for exploration (viz is _unknown_).

<!--
* Web technologies (HTML, JavaScript, CSS, SVG) lack the computational resources for seamless iteration between data manipulation/visualization/modeling.
-->

<div align="center">
  <img src="workflow.svg" width="830" height="300" />
</div>

## The plotly ecosystem

<div align="center">
  <img src="plotly.svg" width="830" height="500" />
</div>

## R packages for interactive web graphics

* Many R packages allow you create  web graphics 
    * A few attempt to be general purpose
        * <b>rCharts</b> (Vaidyanathan et al. 2014), <b>ggvis</b> (Chang and Wickham 2016), <b>rBokeh</b> (Hafen et al. 2016)
    * Many more are domain-specific
        * <b>leaflet</b> (Cheng et al. 2016), <b>dygraphs</b> (Allaire et al. 2016), <b>networkD3</b> (Gandrud et. al. 2016), <b>DiagrammeR</b> (Iannone et al. 2016), <b>d3scatter</b> (Cheng 2016)
    
* Most approaches neglect/ignore linking views and animation.
    * <b>ggvis</b> has some linking/animation, but requires a <b>shiny</b> (Chang 2016) server.
    * <b>animint</b> (Hocking et al. 2016) supports linking/animation by extending <b>ggplot2</b>'s grammar of graphics implementation (Wickham et al. 2017).
    
---

* <b>plotly</b> (Sievert el al. 2016) borrows from and improves upon <b>animint</b>.
    * Also makes <b>ggplot2</b> graphics interactive.
    * Provides a hook for <b>ggplot2</b> extension packages.
        * See <b>ggmosaic</b> (Jeppson et al. 2016), <b>geomnet</b> (Tyner et al. 2016), and <b>ggalt</b> (Rudis et al. 2016).
    * Special support for ggmatrix objects -- an important data structure for the <b>GGally</b> (Schloerke et al. 2016) package.
    * Better support for focusing (zoom/pan) and arranging views. 
    * A "non-ggplot2" interface helps support visualizations not supported by <b>ggplot2</b> (e.g., 3D charts).
    * Supports more complex brushing interactions 
        * Make selections via mouse hover, click, click & drag.
        * Dynamically modify brush color (useful for making comparisons).

# Demo

[See here](https://github.com/cpsievert/talks/tree/gh-pages/20161212a) for the demo script.

## Future work

* Keep adding documentation and examples in the [plotly for R](https://cpsievert.github.io/plotly_book) book.
* Further advance <b>plotly</b>'s support for linking views without <b>shiny</b> (obvious limitations are listed [here](https://cpsievert.github.io/plotly_book/linking-views-without-shiny.html#limitations))

* Extensions for more popular <b>ggplot2</b> extension packages such as <b>ggrepel</b> and <b>ggraph</b>.
  * Integrating <b>plotly</b>'s support for linking tree-structures with <b>ggraph</b> would be particularly interesting.


# Thank you

* Slides -- <http://bit.ly/phd-seminar>
