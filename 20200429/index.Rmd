---
title: "Plot theming made easieR"
venue: "Statistical Programming DC (SPDC)"
type: "invited"
recording: "none"
output:
  xaringan::moon_reader:
    chakra: "../templates/remarkjs/libs/remark-latest.min.js"
    seal: false
    nature:
      # approx the golden ratio
      ratio: '14.6:9'
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      navigation:
        scroll: false
author: "Carson Sievert"
date: ""
---
class: middle, center

# Plot theming made easieR

### Carson Sievert

### Slides: https://talks.cpsievert.me  

`r icon::fa_twitter()` [@cpsievert](https://twitter.com/cpsievert)

`r icon::fa_github()` [@cpsievert](https://github.com/cpsievert)

`r icon::fa_globe()` [cpsievert.me](https://cpsievert.me) 

`r icon::fa_envelope()` <cpsievert1@gmail.com> 


.footnote[
Slides released under <a href='https://github.com/cpsievert/talks/blob/gh-pages/LICENSE'>Creative Commons</a>
]

```{r setup, echo = FALSE}
library(thematic)
library(ggplot2)
library(lattice)
library(flair)
knitr::opts_chunk$set(
  message = FALSE,
  comment = "#>",
  collapse = TRUE,
  fig.align = "center",
  out.width = "100%",
  fig.asp = 1,
  #cache = TRUE,
  #fig.retina = 2,
  dev = "svg"
)
include_vimeo <- function(id, width = "100%", height = "450") {
  url <- sprintf("https://player.vimeo.com/video/%s?title=0&byline=0&portrait=0", id)
  htmltools::tags$iframe(
    src = url,
    width = width,
    height = height,
    frameborder = "0",
    seamless = "seamless",
    webkitAllowFullScreen = NA,
    mozallowfullscreen = NA,
    allowFullScreen = NA
  )
}
auto_defaults_set(
  bg = "#002B36", fg = "#FDF6E3", 
  accent = "#2AA198", 
  # 2 is better for non-ragg
  font = font_spec("Roboto Condensed", 2)
)
```

```{scss, echo = FALSE}
@import url(https://fonts.googleapis.com/css?family=Pacifico);
body {
  font-family: Roboto Condensed;
}
h1, h2, h3 {
  font-family: Roboto Condensed;
}
.remark-slide-content {
  background-color: #002B36;
  color: #FDF6E3;
  a {
    color: #2AA198;
  }
  &.darkly {
    background-color: #222;
    color: #FFF;
    a {
      color: #0CE3AC;
    }
  }
  &.dark-mode {
    background-color:  #444;
    color: #e4e4e4;
    a {
      color: #e39777;
    }
  }
  
  &.lucid {
    background-color: #3D4752;
    color: #FFFFFF;
  }
}
```

---
## [**thematic**](https://github.com/rstudio/thematic): automatically theme **ggplot2**, **lattice**, and **base** R graphics.



Not yet on CRAN, but install it now with:

```r
remotes::install_github("rstudio/thematic")
library(thematic)
```

For auto-theming in **shiny**, you'll currently need:

```r
remotes::install_github("rstudio/shiny#2740")
```

For auto-theming in **rmarkdown**, you'll currently need:

```r
remotes::install_github("rstudio/rmarkdown#1706")
```

Learn more <https://rstudio.github.io/thematic/>

---

## RStudio Cloud Demo

---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

Use `thematic_on()` to opt-in in to new plotting defaults. The "main" color settings are `bg`, `fg`, `accent`.

.pull-left[
```{r intro, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#2AA198"
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) + 
  geom_point() + 
  geom_smooth() 
```

```{r, echo = FALSE}
decorate("intro", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#2AA198"', background = "#2AA198", color = "white")
```

These new defaults _persist to any future plots_ (until `thematic_off()` is called).
]

.pull-right[
```{r, echo = FALSE, fig.asp = 0.9}
thematic_on(font = "auto")
ggplot(mtcars, aes(wt, mpg)) + 
  geom_point(size = 4) + 
  geom_smooth(size = 2.5) +
  theme(legend.position = "top")
```
]

(BTW, the values here intentionally match the CSS of my slides)


---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

Also specify any `font` known to R or any [Google Font](https://fonts.google.com/)<sup>1</sup> (e.g., <span style="font-family:Pacifico">Pacifico</span>)

.pull-left[
```{r fonts, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#2AA198",
  font = "Pacifico"
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) + 
  geom_point() + 
  geom_smooth() 
```

```{r, echo = FALSE}
decorate("fonts", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#2AA198"', background = "#2AA198", color = "white") %>%
  flair("Pacifico")
```

]

.pull-right[
```{r, echo = FALSE, fig.asp = 0.8}
thematic_on(font = font_spec("Pacifico", 2))
last_plot()
```
]

.footnote[
1. Requires **showtext** or **ragg** to be installed, and potential other "setup" (for details, see <https://rstudio.github.io/thematic>)
]


---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

**thematic** informs `theme()` _defaults_ (i.e., plot specific code takes priority)

.pull-left[
```{r theme, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#2AA198",
  font = "Pacifico"
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) + 
  geom_point() + 
  geom_smooth() + 
  theme(axis.title = element_text(color = "#6C71C4"))
```

```{r, echo = FALSE}
decorate("theme", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#2AA198"', background = "#2AA198", color = "white") %>%
  flair('"#6C71C4"', background = "#6C71C4", color = "white")
```

]

.pull-right[
```{r, echo = FALSE, fig.asp = 0.8}
thematic_on(font = font_spec("Pacifico", 2))
ggplot(mtcars, aes(wt, mpg)) + 
  geom_point(size = 4) + 
  geom_smooth(size = 2.5) +
  theme(axis.title = element_text(color = "#6C71C4"))
```
]


---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

**thematic** informs `theme()` _and geom_ defaults

.pull-left[
```{r geom, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#D33682",
  font = "Pacifico"
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) + 
  geom_point(color = "#586E75") + 
  geom_smooth() + 
  theme(axis.title = element_text(color = "#6C71C4"))
```

```{r, echo = FALSE}
decorate("geom", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#D33682"', background = "#D33682", color = "white") %>%
  flair('"#586E75"', background = "#586E75", color = "white") %>%
  flair('"#6C71C4"', background = "#6C71C4", color = "white")
```

]

.pull-right[
```{r, echo = FALSE, fig.asp = 0.8}
thematic_on(accent = "#D33682", font = font_spec("Pacifico", 2))
ggplot(mtcars, aes(wt, mpg)) + 
  geom_point(color = "#586E75", size = 4) + 
  geom_smooth(size = 2.5) +
  theme(axis.title = element_text(color = "#6C71C4"))
```
]

---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

Uses `bg`, `fg`, `accent` to construct a new default for sequential colorscales.

.pull-left[

```{r seq, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#2AA198",
  font = "Roboto Condensed"
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) +
  geom_point(aes(color = cyl))
```

```{r, echo = FALSE}
decorate("seq", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#2AA198"', background = "#2AA198", color = "white") %>%
  flair("color = cyl") 
```

]

.pull-right[
```{r, echo = FALSE}
thematic_on(font = "auto")
ggplot(mtcars, aes(wt, mpg)) + 
  geom_point(aes(color = cyl), size = 4) +
  theme(legend.position = "top")
```
]

---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

Customize with `sequential_gradient()` (here is `fg` -> `accent`)

.pull-left[
```{r seq3, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#2AA198",
  font = "Roboto Condensed",
  sequential=sequential_gradient(1,0)
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) +
  geom_point(aes(color = cyl))
```

```{r, echo = FALSE}
decorate("seq3", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#2AA198"', background = "#2AA198", color = "white") %>%
  flair("color = cyl") %>%
  flair_rx("sequential.*")
```
]

.pull-right[
```{r, echo = FALSE}
thematic_on(font = "auto", sequential = sequential_gradient(1, 0))
last_plot()
```
]

.footnote[
For more examples, see the [customization article](http://rstudio.github.io/thematic/articles/customize.html).
]

---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

Opt-out with `NA`.

.pull-left[
```{r seq2, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#2AA198",
  font = "Roboto Condensed",
  sequential = NA
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) +
  geom_point(aes(color = cyl))
```

```{r, echo = FALSE}
decorate("seq2", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#2AA198"', background = "#2AA198", color = "white") %>%
  flair_rx("sequential.*")
```

]

.pull-right[
```{r, echo = FALSE}
thematic_on(font = "auto", sequential = NA)
last_plot()
```
]


---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

Also sets qualitative colorscale defaults to [Okabe-Ito](https://jfly.uni-koeln.de/color/) (colour-blind safe)

.pull-left[
```{r qual, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#2AA198",
  font = "Roboto Condensed"
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) +
  geom_point(aes(color=factor(cyl)))
```

```{r, echo = FALSE}
decorate("qual", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#2AA198"', background = "#2AA198", color = "white") %>%
  flair("color=factor(cyl)")
```
]

.pull-right[
```{r, echo = FALSE}
thematic_on(font = "auto")
ggplot(mtcars, aes(wt, mpg)) + 
  geom_point(aes(color = factor(cyl)), size = 4) +
  theme(legend.position = "top")
```
]

---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

Customize with any vector of color codes

.pull-left[
```{r qual-custom, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#2AA198",
  font = "Roboto Condensed",
  qualitative = c(
    "#1B9E77", "#D95F02", "#7570B3"
  )
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) +
  geom_point(aes(color=factor(cyl)))
```

```{r, echo = FALSE}
decorate("qual-custom", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#2AA198"', background = "#2AA198", color = "white") %>%
  flair('"#1B9E77"', background = "#1B9E77", color = "white") %>%
  flair('"#D95F02"', background = "#D95F02", color = "white") %>%
  flair('"#7570B3"', background = "#7570B3", color = "white") %>%
  flair("color=factor(cyl)")
```

For **ggplot2**, `qualitative` is only relevant if there are enough colors to encode the levels.
]

.pull-right[
```{r, echo = FALSE}
thematic_on(font = "auto", qualitative = RColorBrewer::brewer.pal(8, "Dark2"))
last_plot()
```
]

---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

Opt-out with `NA`

.pull-left[
```{r qual-na, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#2AA198",
  font = "Roboto Condensed",
  qualitative = NA
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) +
  geom_point(aes(color=factor(cyl)))
```

```{r, echo = FALSE}
decorate("qual-na", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#2AA198"', background = "#2AA198", color = "white") %>%
  flair_rx("qualitative.*") %>%
  flair("color=factor(cyl)")
```
]

.pull-right[
```{r, echo = FALSE}
thematic_on(font = "auto", qualitative = NA)
last_plot()
```
]


---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

[**thematic**](https://github.com/rstudio/thematic) works with **ggplot2** (and extensions)

.pull-left[
```{r ggrepel, eval = FALSE, echo = FALSE}
thematic_on(
  bg = "#002B36", 
  fg = "#FDF6E3", 
  accent = "#2AA198",
  font = "Roboto Condensed"
)
library(ggplot2)
ggplot(mtcars, aes(wt, mpg)) +
  ggrepel::geom_text_repel(
    aes(color = factor(cyl), label = row.names(mtcars))
  )
```

```{r, echo = FALSE}
decorate("ggrepel", eval = FALSE) %>%
  flair('"#002B36"', background = "#002B36", color = "white") %>%
  flair('"#2AA198"', background = "#2AA198", color = "white") %>%
  flair("ggrepel::geom_text_repel")
```
]

.pull-right[
```{r, echo = FALSE, fig.asp=1}
thematic_on(font = "auto")
ggplot(mtcars, aes(wt, mpg)) + 
  ggrepel::geom_text_repel(
    aes(color = factor(cyl), label = row.names(mtcars))
  ) +
  theme(legend.position = "top")
```
]

---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

Also **lattice** graphics:

```{r lattice, eval = FALSE, echo = FALSE}
lattice::show.settings()
```

```{r, echo = FALSE}
decorate("lattice", eval = FALSE) %>%
  flair("lattice")
```

```{r, echo = FALSE, fig.asp=0.618, out.width="80%"}
thematic_on(font = font_spec("auto", 1))
lattice::show.settings()
```


---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

Also **base** graphics:

```{r base, eval = FALSE}
par(mfrow = c(1, 2))
hist(rnorm(100))
plot(rep(1:5, each = 5), rep(1:5, 5), col = 1:25, pch = 1:25)
```

```{r, echo = FALSE, fig.asp=0.55, out.width="80%"}
thematic_on(font = font_spec("auto", 1))
par(mfrow = c(1, 2))
hist(rnorm(100))
plot(rep(1:5, each = 5), rep(1:5, 5), col = 1:25, pch = 1:25, cex = 1.5)
```

---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

...but, for accents, you'll have to inform `col`

```{r base2, eval = FALSE, echo = FALSE}
plot(cars, main = "Stopping Distance versus Speed")
lines(stats::lowess(cars), col = thematic_get_option("accent"))
```

```{r, echo = FALSE}
decorate("base2", eval = FALSE) %>%
  flair('col = thematic_get_option("accent")')
```

```{r, echo = FALSE, fig.asp=0.55, out.width="80%"}
thematic_on(font = font_spec("auto", 1.25))
plot(cars, main = "Stopping Distance versus Speed")
lines(stats::lowess(cars), col = thematic_get_option("accent"), lwd = 3)
```

---
## [**thematic**](https://github.com/rstudio/thematic): simplified theming of R plots

...and same for sequential colorscales

```{r base3, eval = FALSE, echo = FALSE}
par(mfrow = c(1, 2))
image(volcano)
image(volcano, col = thematic_get_option("sequential"))
```

```{r, echo = FALSE}
decorate("base3", eval = FALSE) %>%
  flair('col = thematic_get_option("sequential")')
```

```{r, echo = FALSE, fig.asp=0.55, out.width="80%"}
thematic_on(font = font_spec("auto", 1.25))
par(mfrow = c(1, 2))
image(volcano)
image(volcano, col = thematic_get_option("sequential"))
```

---
class: darkly

### [**thematic**](https://github.com/rstudio/thematic): auto theming

Call `thematic_on()` without any arguments for auto coloring (works w/ any [**shiny** runtime](http://rstudio.github.io/thematic/articles/shiny.html) and [rmarkdown::html_document()](http://rstudio.github.io/thematic/articles/rmarkdown.html))

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/KewYfYq.gif")
```

---
class: darkly

### [**thematic**](https://github.com/rstudio/thematic): auto theming

Call `thematic_on(font = "auto")` if you know your app/document uses Google Font (or a font that R knows about).

```{r, echo = FALSE}
knitr::include_graphics("https://i.imgur.com/yG5uTlY.gif")
```

---
class: darkly

### [**thematic**](https://github.com/rstudio/thematic): auto theming

Auto theming also works in RStudio ([RStudio 1.4 or higher](http://rstudio.github.io/thematic/articles/rstudio.html), which is _very_ new, and currently has [known bugs](https://github.com/rstudio/rstudio/issues/6679), is required for Google Fonts). Here is my setup with `thematic_on(font = "Fira Sans Condensed")`

```{r, echo = FALSE, out.width="88%"}
knitr::include_graphics("rstudio.png")
```

---
class: dark-mode 

**thematic** resolves auto values at plot time, so it works with [**bootstraplib**'s real-time themer](https://rstudio.github.io/bootstraplib/articles/recipes.html)!

```{r bootstraplib, eval = FALSE, echo = FALSE}
library(bootstraplib)
bs_theme_new()
bs_theme_base_colors(bg = "#444", fg = "#e4e4e4")
bs_theme_accent_colors(primary = "#e39777")
thematic_on(font = "auto")
bs_theme_preview()
```

```{r, echo = FALSE}
decorate("bootstraplib", eval = FALSE) %>%
  flair('"#444"', background = "#444", color = "white") %>%
  flair('"#e4e4e4"', background = "#e4e4e4", color = "black") %>%
  flair('"#e39777"', background = "#e39777", color = "white")
```


```{r, echo = FALSE}
include_vimeo("411238499", height = "400")
```

---
class: middle, center

## RStudio Cloud Demo

Follow along at <https://bit.ly/thematic-cloud>

<div>
  <a href="https://rstudio.cloud/project/1208127" target="_blank">
    <img src="thematic-cloud.svg" alt="RStudio Cloud Example" height="80px" style="display: block; margin: 0 auto;">
  </a>
</div>

---
## TODO

* Mention `auto_preferences_set()`
  * non-HTML **rmarkdown**
  * Useful for more complicated projects (like this one!)

* Get into `shiny::getCurrentOutputInfo()`
  * Talk about how (htmlwidget) developers can leverage this
  
* `ggplotly()`?

---
## Future work

This work is part of an larger initiate to enable better theming experience in **shiny**, **rmarkdown**, etc. Keep on the lookout for:

* Shiny
* R Markdown
* DT
* plotly
* flexdashboard

---
class: center, middle

## Thank you! Any questions?

### Slides: <https://talks.cpsievert.me>

### Learn more: <https://rstudio.github.io/thematic>

#### Contact

`r icon::fa_twitter()` <a href='https://twitter.com/cpsievert'>@cpsievert</a> <br />
`r icon::fa_github()` <a href='https://github.com/cpsievert'>@cpsievert</a> <br />
`r icon::fa_envelope()` <cpsievert1@gmail.com> <br />
`r icon::fa_globe()` <https://cpsievert.me/>


.footnote[
Slides made possible thanks to [**xaringan**](https://github.com/yihui/xaringan) and [**flair**](https://github.com/kbodwin/flair)
]

