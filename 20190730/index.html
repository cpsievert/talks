<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>When to JavaScript?</title>
    <meta charset="utf-8" />
    <meta name="author" content="Carson Sievert, PhD   Software Engineer, RStudio" />
    <link href="index_files/font-awesome-5.3.1/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: middle, center, inverse

# Why JavaScript?

### Carson Sievert, PhD &lt;br/&gt; Software Engineer, RStudio

### Slides: https://talks.cpsievert.me

### <i class="fab  fa-twitter "></i> &lt;a href='https://twitter.com/cpsievert'&gt;@cpsievert&lt;/a&gt; &lt;br/&gt; <i class="fas  fa-globe "></i> &lt;https://cpsievert.me&gt; &lt;br/&gt; <i class="fas  fa-envelope "></i> &lt;cpsievert1@gmail.com&gt;

---
class: middle, center, inverse

&lt;font color="#BF0F0F" style="font-size:2em;position:absolute;top:75px;left:340px"&gt;When to&lt;/font&gt;
&lt;img src="crossout.png" width="100px" style="position:absolute;top:130px;left:340px" /&gt;

# Why JavaScript?

### Carson Sievert, PhD &lt;br/&gt; Software Engineer, RStudio

### Slides: https://talks.cpsievert.me

### <i class="fab  fa-twitter "></i> &lt;a href='https://twitter.com/cpsievert'&gt;@cpsievert&lt;/a&gt; &lt;br/&gt; <i class="fas  fa-globe "></i> &lt;https://cpsievert.me&gt; &lt;br/&gt; <i class="fas  fa-envelope "></i> &lt;cpsievert1@gmail.com&gt;

---
class: middle

## "Of course someone has to write for loops. &lt;br&gt; It doesn’t have to be you."

- Jenny Bryan (Software Engineer, RStudio)



---
class: middle

&lt;img src="crossout.png" width="150px" style="position:absolute;top:255px;right:125px" /&gt;

&lt;font color="#BF0F0F" style="font-size:2em;position:absolute;top:205px;right:125px"&gt;JavaScript&lt;/font&gt;

## "Of course someone has to write for loops. It doesn’t have to be you."

- Me, for similar reasons

---
class: middle

## Why avoid for loops (and JavaScript)?

&gt; &lt;font style='font-size:1.5em'&gt; "It is all too easy for statistical thinking to be swamped by programming tasks." &lt;/font&gt; (Brian D. Ripley)

---

## What does this R code do?

&lt;pre&gt;&lt;code&gt;
out1 &lt;- vector("double", ncol(mtcars))
for (i in seq_along(mtcars)) {
  out1[[i]] &lt;- mean(mtcars[[i]], na.rm = TRUE)
}

out2 &lt;- vector("double", ncol(mtcars))
for (i in seq_along(mtcars)) {
  out2[[i]] &lt;- median(mtcars[[i]], na.rm = TRUE)
}
&lt;/code&gt;&lt;/pre&gt;


.footnote[
Example from Hadley Wickham's _Building Tidy Tools_ [workshop](https://blog.rstudio.com/2019/02/06/rstudio-conf-2019-workshops/).
]

---

## For loops emphasize the objects

&lt;pre&gt;&lt;code&gt;
&lt;font color="red"&gt;out1&lt;/font&gt; &lt;- vector("double", &lt;font color="red"&gt;ncol(mtcars)&lt;/font&gt;)
for (i in seq_along(&lt;font color="red"&gt;mtcars&lt;/font&gt;)) {
  &lt;font color="red"&gt;out1[[i]]&lt;/font&gt; &lt;- mean(&lt;font color="red"&gt;mtcars[[i]]&lt;/font&gt;, na.rm = TRUE)
}

&lt;font color="red"&gt;out2&lt;/font&gt; &lt;- vector("double", &lt;font color="red"&gt;ncol(mtcars))&lt;/font&gt;
for (i in seq_along(&lt;font color="red"&gt;mtcars&lt;/font&gt;)) {
  &lt;font color="red"&gt;out2[[i]]&lt;/font&gt; &lt;- median(&lt;font color="red"&gt;mtcars[[i]]&lt;/font&gt;, na.rm = TRUE)
}
&lt;/code&gt;&lt;/pre&gt;

.footnote[
Example from Hadley Wickham's _Building Tidy Tools_ [workshop](https://blog.rstudio.com/2019/02/06/rstudio-conf-2019-workshops/).
]

---

## Not the actions

&lt;pre&gt;&lt;code&gt;
out1 &lt;- vector("double", ncol(mtcars))
for (i in seq_along(mtcars)) {
  out1[[i]] &lt;- &lt;font color="red"&gt;mean&lt;/font&gt;(mtcars[[i]], na.rm = TRUE)
}

out2 &lt;- vector("double", ncol(mtcars))
for (i in seq_along(mtcars)) {
  out2[[i]] &lt;- &lt;font color="red"&gt;median&lt;/font&gt;(mtcars[[i]], na.rm = TRUE)
}
&lt;/code&gt;&lt;/pre&gt;

.footnote[
Example from Hadley Wickham's _Building Tidy Tools_ [workshop](https://blog.rstudio.com/2019/02/06/rstudio-conf-2019-workshops/).
]

---

## Functional programming weights equally


&lt;pre&gt;&lt;code&gt;
library(purrr)
means &lt;- map_dbl(&lt;font color="red"&gt;mtcars&lt;/font&gt;, &lt;font color="red"&gt;mean&lt;/font&gt;)
medians &lt;- map_dbl(&lt;font color="red"&gt;mtcars&lt;/font&gt;, &lt;font color="red"&gt;median&lt;/font&gt;)
&lt;/code&gt;&lt;/pre&gt;

.footnote[
Example from Hadley Wickham's _Building Tidy Tools_ [workshop](https://blog.rstudio.com/2019/02/06/rstudio-conf-2019-workshops/).
]


---

## Functional programming weights equally


&lt;pre&gt;&lt;code&gt;
library(purrr)
means &lt;- map_dbl(&lt;font color="red"&gt;mtcars&lt;/font&gt;, &lt;font color="red"&gt;mean&lt;/font&gt;)
medians &lt;- map_dbl(&lt;font color="red"&gt;mtcars&lt;/font&gt;, &lt;font color="red"&gt;median&lt;/font&gt;)
&lt;/code&gt;&lt;/pre&gt;

### For more, see ["The Joy of Functional Programming (for Data Science)"](https://www.youtube.com/watch?v=bzUmK0Y07ck) by Hadley Wickham

.footnote[
Example from Hadley Wickham's _Building Tidy Tools_ [workshop](https://blog.rstudio.com/2019/02/06/rstudio-conf-2019-workshops/).
]

---

&lt;font color="#BF0F0F" style="font-size:2em; position:absolute; top:20px; left:100px"&gt;JavaScript&lt;/font&gt;

&lt;img src="crossout.png" width="140px" style="position:absolute;top:65px;left:100px" /&gt;
## For loop emphasizes objects 

&lt;br&gt;
&lt;br&gt;
&lt;br&gt;

### JavaScript: a language for manipulating the Document **Object** Model (DOM)!

* &lt;font style="font-size:1.5em"&gt;D3 make it easier to map data to the DOM, but you're still &lt;i&gt;working with&lt;/i&gt; HTML/SVG/CSS etc.&lt;/font&gt;

---
## D3 scatterplot example

&lt;img src="d3-scatterplot.png" width="100%" /&gt;

---

.scroll-output[
```html
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;meta charset="utf-8"&gt;

&lt;style&gt;
body {
  font: 11px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.dot {
  stroke: #000;
}

.tooltip {
  position: absolute;
  width: 200px;
  height: 28px;
  pointer-events: none;
}
&lt;/style&gt;
&lt;body&gt;
&lt;script src="https://d3js.org/d3.v3.min.js"&gt;&lt;/script&gt;

&lt;script&gt;
var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;

/* 
 * value accessor - returns the value to encode for a given data object.
 * scale - maps value to a visual display encoding, such as a pixel position.
 * map function - maps from data value to display value
 * axis - sets up axis
 */ 

// setup x 
var xValue = function(d) { return d.Calories;}, // data -&gt; value
    xScale = d3.scale.linear().range([0, width]), // value -&gt; display
    xMap = function(d) { return xScale(xValue(d));}, // data -&gt; display
    xAxis = d3.svg.axis().scale(xScale).orient("bottom");

// setup y
var yValue = function(d) { return d["Protein (g)"];}, // data -&gt; value
    yScale = d3.scale.linear().range([height, 0]), // value -&gt; display
    yMap = function(d) { return yScale(yValue(d));}, // data -&gt; display
    yAxis = d3.svg.axis().scale(yScale).orient("left");

// setup fill color
var cValue = function(d) { return d.Manufacturer;},
    color = d3.scale.category10();

// add the graph canvas to the body of the webpage
var svg = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// add the tooltip area to the webpage
var tooltip = d3.select("body").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

// load data
d3.csv("cereal.csv", function(error, data) {

  // change string (from CSV) into number format
  data.forEach(function(d) {
    d.Calories = +d.Calories;
    d["Protein (g)"] = +d["Protein (g)"];
//    console.log(d);
  });

  // don't want dots overlapping axis, so add in buffer to data domain
  xScale.domain([d3.min(data, xValue)-1, d3.max(data, xValue)+1]);
  yScale.domain([d3.min(data, yValue)-1, d3.max(data, yValue)+1]);

  // x-axis
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis)
    .append("text")
      .attr("class", "label")
      .attr("x", width)
      .attr("y", -6)
      .style("text-anchor", "end")
      .text("Calories");

  // y-axis
  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("class", "label")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .text("Protein (g)");

  // draw dots
  svg.selectAll(".dot")
      .data(data)
    .enter().append("circle")
      .attr("class", "dot")
      .attr("r", 3.5)
      .attr("cx", xMap)
      .attr("cy", yMap)
      .style("fill", function(d) { return color(cValue(d));}) 
      .on("mouseover", function(d) {
          tooltip.transition()
               .duration(200)
               .style("opacity", .9);
          tooltip.html(d["Cereal Name"] + "&lt;br/&gt; (" + xValue(d) 
	        + ", " + yValue(d) + ")")
               .style("left", (d3.event.pageX + 5) + "px")
               .style("top", (d3.event.pageY - 28) + "px");
      })
      .on("mouseout", function(d) {
          tooltip.transition()
               .duration(500)
               .style("opacity", 0);
      });

  // draw legend
  var legend = svg.selectAll(".legend")
      .data(color.domain())
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  // draw legend colored rectangles
  legend.append("rect")
      .attr("x", width - 18)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);

  // draw legend text
  legend.append("text")
      .attr("x", width - 24)
      .attr("y", 9)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d;})
});

&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
```
]
  
---
### 'High-level' JS libraries reduce 'DOM cruft'

&lt;div align="center"&gt;
  &lt;img src="bars.png" height="250" /&gt;
&lt;/div&gt;

.pull-left[
```html
&lt;html&gt;
  &lt;script src="https://cdn.plot.ly/plotly-latest.min.js"&gt;&lt;/script&gt;
  &lt;body&gt;
    &lt;div id="graph"&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
```
]

.pull-right[
```javascript
var bar = {
  x: [1, 2, 3],
  y: ["a", "b", "c"],
  type: "bar"
}
Plotly.plot("graph", {data: [bar]})
```
]

---
### 'High-level' JS libraries reduce 'DOM cruft'

- &lt;font style="font-size:1.5em"&gt; 👍 Compared to D3, more weight on the domain problem&lt;/font&gt;
* &lt;font style="font-size:1.5em"&gt; 👎 HTML boilerplate&lt;/font&gt;
- &lt;font style="font-size:1.5em"&gt; 👎 Web tech generally lacks tools for data transformation and inspection&lt;/font&gt;

&lt;br/&gt;

.pull-left[
```html
&lt;html&gt;
  &lt;script src="https://cdn.plot.ly/plotly-latest.min.js"&gt;&lt;/script&gt;
  &lt;body&gt;
    &lt;div id="graph"&gt;&lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
```
]

.pull-right[
```javascript
var bar = {
  x: [1, 2, 3],
  y: ["a", "b", "c"],
  type: "bar"
}
Plotly.plot("graph", {data: [bar]})
```
]

---
## Data science workflow

&lt;img src="data-science.svg" width="100%"/&gt;

.footnote[
Diagram from Wickham and Grolemund (2017), [_R for Data Science_](https://r4ds.had.co.nz/) 
]

---
class: middle

&lt;img src="data-science-communication.svg" width="100%"/&gt;

---
class: middle

&lt;img src="data-science-understanding.svg" width="100%"/&gt;

---
class: middle

&lt;img src="data-science-understanding-r.svg" width="100%"/&gt;

---
background-image: url(why-not-both.gif)
background-size: contain


&lt;!--
Programming in JavaScript might help you create graphics that help your audience explore data, but I don't recommend it for helping yourself 
--&gt;

---
### htmlwidgets: a bridge between R and JS libraries

&lt;http://gallery.htmlwidgets.org&gt;

&lt;img src="htmlwidgets.png" width="100%" /&gt;

---

```r
library(plotly)
albersusa::usa_sf("laea") %&gt;% 
  cartogram::cartogram_cont("pop_2014") %&gt;%
  plot_ly(us_cont) %&gt;% 
  add_sf(color = ~pop_2014, split = ~name, span = I(1), text = ~paste(name, scales::number_si(pop_2014))) %&gt;%
  colorbar(title = "Population \n 2014")
```

&lt;iframe src="cartogram.html" width="100%" height="450" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;

---

## htmlwidgets: nice for single view interaction

https://vimeo.com/315707813


---
background-image: url(https://i.imgur.com/T7GSpv9.gif)
background-size: contain

## shiny: great for coordinating multiple views




&lt;!--

## So, when _should_ statisticians learn JavaScript?

1. You know _exactly_ what type of visual interface you want
  -  Weeks to prototype in shiny+ggplot2, months to prototype in D3js
    
2. The 'prior art' doesn't do what you need
  - Nowadays, you can get a *long* way with **htmlwidgets**, **shiny**, and **rmarkdown**

3. You want to build tools that enable others
--&gt;

---
## That being said...

Knowing 'enough' JavaScript can be powerful, especially if you leverage existing 'scaffolding'!

```r
plot_ly(mtcars, x = ~wt, y = ~mpg) %&gt;%
  add_markers(
    text = rownames(mtcars),
    customdata = paste0("http://google.com/#q=", rownames(mtcars))
  ) %&gt;%
  htmlwidgets::onRender("function(el) {
    el.on('plotly_click', function(d) {
      var url = d.points[0].customdata;
      window.open(url);
    });
  }")
```

---

## Click on a point to google search

&lt;iframe src="scatterplot.html" width="100%" height="370" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;

### Learn more about registering custom JavaScript events with **plotly** -- &lt;https://plotly-r.com/javascript.html&gt;

---

## So, you want to 'learn JavaScript'

### Have a goal in mind and learn the fundamentals

HTML, JSON, *vanilla* JavaScript, and CSS. Maybe D3.

### Don't get caught up in the framework-of-the-day (e.g. React, Vue, Angular, etc)

Especially if you're willing and able to use **shiny**.

### Don't waste your time on build tools (e.g., Webpack, Grunt, etc)

You can get a long way doing thing the old-fashioned way.

---

## In summary

### functional programming : for loops :: htmlwidgets : JavaScript
  * Don't waste your time on programming 'cruft' if don't need to!
  
  
* Programming in JavaScript, like for loops, pulls focus away from the main task/action.
    * Functional programming offers a nice alternative to for loops

* Web programming tools are not designed for EDA
  * Bad at transforming and inspecting data

* R bindings to JS libs (i.e., htmlwidgets, shiny, etc) help bring the power of the web
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="../templates/remarkjs/libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "14.6:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
