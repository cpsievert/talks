<!DOCTYPE html>
<html>
  <head>
    <title>Fitting interactive web graphics into a data science workflow</title>
    <meta charset="utf-8">
    <meta name="author" content="Carson Sievert" />
    <link href="index_files/remark-css/example.css" rel="stylesheet" />
    <link href="index_files/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="main.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Fitting interactive web graphics into a data science workflow
### Carson Sievert
### Slides: <a href="https://talks.cpsievert.me" class="uri">https://talks.cpsievert.me</a> <br /> <br /> <i class="fa  fa-twitter "></i> <a href='https://twitter.com/cpsievert'><span class="citation" data-cites="cpsievert">@cpsievert</span></a> <br /> <i class="fa  fa-github "></i> <a href='https://github.com/cpsievert'><span class="citation" data-cites="cpsievert">@cpsievert</span></a> <br /> <i class="fa  fa-envelope "></i> <a href="mailto:cpsievert1@gmail.com">cpsievert1@gmail.com</a> <br /> <i class="fa  fa-globe "></i> <a href="https://cpsievert.me/" class="uri">https://cpsievert.me/</a> <br /> <br /> Slides released under <a href='https://github.com/cpsievert/talks/blob/gh-pages/LICENSE'>Creative Commons</a>

---

class: principles 

## About me

* PhD in statistics at Iowa State with Dr. Heike Hofmann (Dec 2016) 
  
  * Thesis: [Interfacing R with Web Technologies for Interactive Statistical Graphics and Computing with Data](http://lib.dr.iastate.edu/etd/15422/)
  
* CEO of [Sievert Consulting](https://consulting.cpsievert.me/) LLC (Jan 2017)

  * Clients include: plotly, NOAA, O'Reilly, Sandia
  
  * Looking for more part-time projects
  
* The majority of my work is in interactive data visualization
  
  * Primilarily work in R, dabble in JavaScript and python.
  
  * Maintain numerous R packages including: plotly, LDAvis, pitchRx

---
background-image: url(../20171207/workflow.svg)
background-size: contain
class: inverse

# Data Science Workflow


---
background-image: url(../20171207/workflow1.svg)
background-size: contain
class: inverse

# Expository vis

&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;


### The web is the preferred medium for communicating results

### Assuming you know _exactly_ what you want to visualize, many good data vis frameworks exist (e.g. [d3.js](https://d3js.org/))

---
background-image: url(../20171207/workflow2.svg)
background-size: contain
class: inverse

# Exploratory vis

&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;

### Web technologies weren't designed for data exploration
### People [seem to have forgotten](http://flowingdata.com/2016/03/08/what-i-use-to-visualize-data/) how interative graphics augment exploration

---
class: principles

## Interactive graphics augment exploration!

* Identify structure that otherwise goes missing ([Tukey 1972](http://stat-graphics.org/movies/prim9.html)).
    
* "Search for information quickly without fully specified questions" ([Unwin &amp; Hofmann, 2000](https://www.researchgate.net/publication/2425912_GUI_and_Command-line_-_Conflict_or_Synergy))
    * "[Mutiple linked views] are the optimal framework for posing queries about data" ([Buja et al 1996](https://www.jstor.org/stable/1390754))
    
    * Check out visual ([Majumder et al 2013](http://amstat.tandfonline.com/doi/abs/10.1080/01621459.2013.808157?journalCode=uasa20#.Wl01_ZM-dTY)) and post-selection ([Berk et al 2013](https://projecteuclid.org/euclid.aos/1369836961)) inference frameworks.
    
* Better understand/diagnose models ([Wickham, Cook, &amp; Hofmann 2015](http://onlinelibrary.wiley.com/doi/10.1002/sam.11271/abstract)).

.footnote[
---

Statisticians were building (very advanced!) int graphics systems decades ago --   &lt;http://stat-graphics.org/movies/&gt;
]

---
class: principles

## Interactive graphics augment exploration!

* Identify structure that otherwise goes missing ([Tukey 1972](http://stat-graphics.org/movies/prim9.html)).

* "Search for information quickly without fully specified questions" ([Unwin &amp; Hofmann, 2000](https://www.researchgate.net/publication/2425912_GUI_and_Command-line_-_Conflict_or_Synergy))
    * "[Mutiple linked views] are the optimal framework for posing queries about data" ([Buja et al 1996](https://www.jstor.org/stable/1390754))
    
    * Check out visual ([Majumder et al 2013](http://amstat.tandfonline.com/doi/abs/10.1080/01621459.2013.808157?journalCode=uasa20#.Wl01_ZM-dTY)) and post-selection ([Berk et al 2013](https://projecteuclid.org/euclid.aos/1369836961)) inference frameworks.
    
* &lt;div class="highlight"&gt;Better understand/diagnose models&lt;/div&gt; ([Wickham, Cook, &amp; Hofmann 2015](http://onlinelibrary.wiley.com/doi/10.1002/sam.11271/abstract)).

---
## Deeper look at linear model diagnostics

```r
# choose a model by AIC stepping backwards 
mod &lt;- step(lm(mpg ~ ., data = mtcars), trace = FALSE)

# produce (static ggplot2) diagnostic plot
library(GGally)
pm &lt;- ggnostic(mod, mapping = aes(color = am))

# make it interactive
library(plotly)
ggplotly(pm)
```

---

&lt;iframe src="ggnostic.html" width="100%" height="750" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;

???

The noticeably high value of cooksd suggests a large influence on the fitted model. Highlighting this point makes it obvious that it is influential since it has a unusually high response/residual in a fairly sparse region of the design space (i.e., it has a pretty high value of wt) and removing it would significantly reduce the estimated standard deviation (sigma). By comparison, the other two observations with similar values of wt have a response value very close to the overall mean, so even though their value of hat is high, their value of sigma is low.

---
background-image: url(../20170803/tour.gif )
background-size: contain
class: inverse

---
background-image: url(../20170803/tour.gif )
background-size: contain
class: middle

## Cute idea: plot model in the data space!

---
class: middle, inverse

# Designing, building, maintaining, and publishing a *general purpose* vis library (e.g. plotly) is very hard!

### Grad students: make your life easier...design a *domain specific* tool


---
class: middle, inverse

# Designing, building, maintaining, and publishing a *general purpose* vis library (e.g. plotly) is very hard!

### Grad students: make your life easier...design a *domain specific* tool

.footnote[
#### For example: the [R package LDAvis](https://github.com/cpsievert/LDAvis) for topic model interpretation (joint work with [Kenny Shirley](http://www.kennyshirley.com/)).
]

---
class: principles

## An Example: LDA Topic models

* _Topic models_ are a collection of statistical models with the common goal of finding hidden structure in a collection of text documents.

* __Basic example__: Given a document discussing 'sports', you're more likely to see the word 'baseball' in that document compared to a document discussing 'music' (and vice-versa for 'guitar').

* Documents usually don't have a clear "topic", but we can develop models with latent RV to "discover topics". 

* Latent Dirichlet Allocation (LDA) is a topic model which allows documents to be mixtures of topics (Blei, Ng, Jordan; 2003). 

---

### The Generative Model
1. Choose # of topics `\(K\)`. Let `\(V\)` be # of unique words (vocabulary).
2. For each document `\(d \in \{1,...,D\}\)`, draw `\(\Theta_d \sim Dir(\alpha)\)` where `\(\Theta_d = (\theta_1, ..., \theta_K) &gt; 0\)` and `\(\sum_{i=1}^K \theta_i = 1\)`
3. For each topic `\(k \in \{1,...,K\}\)`, draw `\(\Phi_k \sim Dir(\beta)\)` where `\(\Phi_k = (\phi_1, ..., \phi_V) &gt; 0\)` and `\(\sum_{i=1}^K \phi_i = 1\)`
4. Let `\(N_d\)` be # of words in doc `\(d\)` and `\(n \in \{1, \dots, N_d\}\)`. For each word `\(w_{d, n}\)`:
    * Draw a (latent) topic, `\(z_{d, n} \sim Mult(1, \Theta_d)\)`
    * Draw a word given topic, `\(w_{d, n} \sim Mult(1, \Phi_{z_{d, n}})\)`
    
### Model fitting
* Griffiths &amp; Steyvers (2004) derive a collapsed Gibbs sampler. Implemented in R packages __LDAtools__ (Shirley &amp; Sievert, 2013) and __lda__ (Chang, 2015).
* Wide array of fitting algorithms available in __topicmodels__ (Grun &amp; Hornik, 2011) and __mallet__ (Mimno, 2013).

---
## Model Output

&lt;div align="center"&gt;
  &lt;img src="lda.png" width="800" height="380" /&gt;
&lt;/div&gt;

* In the digital humanities (&amp; elsewhere), LDA is often used to "discover topics" in a large collection of text documents. 
* How are researchers supposed to interpret topics? We can't possibly examine each pmf.
* "Overview first, then zoom &amp; filter, then detail on demand" (Schneiderman, 1996)

---
class: principles
## Towards topic interpretation

* Numerous interactive systems allow users to select a topic `\(z\)`, then list top ~30 words based on `\(p(w | z)\)` (Gardner et al., 2010; Chaney and Blei, 2012; Snyder et al., 2013).

* But, words likely to occur overall are also likely to occur for a given topic!

* Taddy (2011) proposed to rank terms by `\(lift = p(w | z)/p(w)\)`

* But if `\(p(w)\)` is small, `\(lift\)` is large!

* Bischof and Airoldi (2012) propose a new model to directly estimate an average frequency and exclusivity to a given topic.

* Sievert &amp; Shirley (2014) propose choosing `\(0 &lt; \lambda &lt; 1\)`, for:

`\(\text{relevance}(\lambda) = \lambda * p(w|z) + (1 - \lambda) * \text{lift}\)`

---
## Choosing lambda

&lt;div align="center"&gt;
  &lt;img src="lambda.png" width="500" height="400" /&gt;
&lt;/div&gt;

* We expect the optimal value of `\(\lambda\)` to vary across data.
* __LDAvis__ allows users to interactively alter rankings by changing `\(\lambda\)`

---

&lt;div align="center"&gt;
  &lt;a href="LDAvis/#topic=4"&gt;
    &lt;img src="LDAvis1.png" width="900" height="550" /&gt;
  &lt;/a&gt;
&lt;/div&gt;


---

&lt;div align="center"&gt;
  &lt;a href="LDAvis/#topic=4"&gt; 
    &lt;img src="LDAvis1.gif" width="900" height="550" /&gt;
  &lt;/a&gt;
&lt;/div&gt;

---

&lt;div align="center"&gt;
  &lt;a href="LDAvis/#topic=4"&gt; 
    &lt;img src="LDAvis2.gif" width="900" height="550" /&gt;
  &lt;/a&gt;
&lt;/div&gt;


---

&lt;div align="center"&gt;
  &lt;a href="LDAvis/#topic=15&amp;lambda=0.56&amp;term=win"&gt; 
    &lt;img src="LDAvis3.gif" width="900" height="550" /&gt;
  &lt;/a&gt;
&lt;/div&gt;

???
http://localhost:8000/#topic=15&amp;lambda=0.56&amp;term=win

The word "win" is probably an abbreviation for "windows" in topic 15. By hovering over "win", we reveal its conditional topic distribution, which is useful finding different uses of that word. Topics 9 and 26 seems to be discussing baseball and hockey, so win is probably referring to "winning games". Topic 39 also seems to be related to sports, but many of the releavnt terms are abbreviations, so "win" may be a team code.


---
class: principles

## Interactive graphics augment exploration!

* Identify structure that otherwise goes missing ([Tukey 1972](http://stat-graphics.org/movies/prim9.html)).
    
* Search for information quickly without fully specified questions ([Unwin &amp; Hofmann, 2000](https://www.researchgate.net/publication/2425912_GUI_and_Command-line_-_Conflict_or_Synergy))
    * &lt;div class="highlight"&gt;[Mutiple linked views] are the optimal framework for posing queries about data&lt;/div&gt; ([Buja et al 1996](https://www.jstor.org/stable/1390754))
    
    * Check out visual ([Majumder et al 2013](http://amstat.tandfonline.com/doi/abs/10.1080/01621459.2013.808157?journalCode=uasa20#.Wl01_ZM-dTY)) and post-selection ([Berk et al 2013](https://projecteuclid.org/euclid.aos/1369836961)) inference frameworks.
    
* Better understand/diagnose models ([Wickham, Cook, &amp; Hofmann 2015](http://onlinelibrary.wiley.com/doi/10.1002/sam.11271/abstract)).

---

## 2016 Election Outcomes by County ([Politico](http://rpubs.com/dgrtwo/county-results))

```
     County |   State | TotalVotes| Clinton| Johnson| Stein| Trump| Population|    Area
    --------| --------| ----------|--------|--------|------|------|-----------|--------
1   autauga | alabama |      24661|   0.240|   0.022| 0.004| 0.734|      54571|  594.44
2   baldwin | alabama |      94090|   0.196|   0.026| 0.005| 0.774|     182265| 1589.78
3   barbour | alabama |      10390|   0.467|   0.009| 0.002| 0.523|      27457|  884.88
4      bibb | alabama |       8748|   0.214|   0.014| 0.002| 0.770|      22915|  622.58
5    blount | alabama |      25384|   0.085|   0.013| 0.004| 0.899|      57322|  644.78
6   bullock | alabama |       4701|   0.751|   0.005| 0.002| 0.242|      10914|  622.81
7    butler | alabama |       8685|   0.428|   0.007| 0.001| 0.563|      20947|  776.83
8   calhoun | alabama |      47376|   0.279|   0.024| 0.006| 0.692|     118572|  605.87
9  chambers | alabama |      13778|   0.418|   0.012| 0.003| 0.566|      34215|  596.53
10 cherokee | alabama |      10503|   0.145|   0.014| 0.002| 0.839|      25989|  553.70
# ... with 3,101 more rows
```

* Is there a relationship between population density and voting preference? 

---
class: middle, center

&lt;iframe src="https://player.vimeo.com/video/202650161" width="800" height="500" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen&gt;&lt;/iframe&gt;

---

.pull-left[
&lt;img src="../gifs/drowning.gif" width="80%"/&gt;
]

.pull-right[
# Lost in a sea of interactive techniques?

### My advice: group together techniques by the data analysis tasks they help accomplish
]

---
background-image: url(../20171207/taxonomy.svg)
background-size: contain
class: bottom, inverse

## Techniques that support data analysis [Buja et al 1996](https://www.jstor.org/stable/1390754)


---
class: inverse, center, middle

# "Statistical software should be expressive, powerful, fast and reliable, but it should also be intuitive, easy to use, flexible, forgiving and consistent"

.footnote[
### From Hofmann &amp; Unwin, [*GUI and Command-line - Conflict or Synergy?*](https://www.researchgate.net/publication/2425912_GUI_and_Command-line_-_Conflict_or_Synergy)
]

---
class: inverse, center, middle

# Statistical software should be &lt;font color='red'&gt;expressive, powerful, fast and reliable&lt;/font&gt;, but it should also be &lt;font color='#119dff'&gt;intuitive, easy to use, flexible, forgiving and consistent&lt;/font&gt;

.footnote[

### &lt;font color='red'&gt;Programming languages are good at this!&lt;/font&gt;

### &lt;font color='#119dff'&gt;Graphical interfaces are good at this!&lt;/font&gt;

]

---
background-image: url(https://i.imgur.com/c7NJRa2.gif)
background-size: contain
class: inverse

# The ideal system leverages the benefits of both worlds

---
background-image: url(../gifs/swamp.gif)
background-size: contain
class: inverse, center, bottom

## It is all too easy for statistical thinking to be **swamped by programming tasks.** -- Brian D. Ripley


???

So, this is me, in my 2nd year of grad school, deciding to learn D3 &amp; JavaScript.

It took me 6+ months to implement a single interactive visualization.

And let me tell you, you guys, no joke, believe me, I arose from the swamp, and decide I alone will...


---
background-image: url(../gifs/drain-the-swamp.gif)
background-size: contain
class: inverse, center

# ☝ 🍊 

---

## What's in the swamp?

.pull-left[
## Exploratory quicksand

&lt;div class="principles"&gt;
• Start-up &lt;br/&gt;
• Iteration &lt;br/&gt;
• Dead-end
&lt;/div&gt;
]

.pull-right[
## Expository quicksand

&lt;div class="principles"&gt;
• Deployment &lt;br/&gt;
• Latency
&lt;/div&gt;
]

---
class: inverse, middle, center

## *How* to drain the swamp?

.footnote[
### What follows are some details &amp; my suggestions about how one might go about it
]

---

## How to drain the swamp? &lt;div class="highlight"&gt; R 📦s that avoid &lt;/div&gt;

.pull-left[
## Exploratory

&lt;div class="principles"&gt;
&lt;div class="highlight"&gt; • Start-up quicksand&lt;/div&gt; &lt;br/&gt;
• Iteration &lt;br/&gt;
• Dead-end
&lt;/div&gt;
]

.pull-right[
## Expository

&lt;div class="principles"&gt;
• Deployment &lt;br/&gt;
• Latency
&lt;/div&gt;
]

&lt;br/&gt;

&lt;div class="highlight"&gt;
* Getting started should be easy!
  * Easy install (CRAN) &amp; copy/paste examples
  * Build upon existing knowledge and tools
&lt;div&gt;

---
background-image: url(../20171207/europe.png)
background-size: contain
class: inverse

---
background-image: url(../20171207/europe.png)
background-size: contain
class: middle

.pull-left[
# Neat, but I can't: 

&lt;div class="principles"&gt;
• Query populations &lt;br /&gt;
• Zoom/pan &lt;br /&gt;
• Compare population at given lat
&lt;/div&gt;
]

---

```r
library(tidyverse)

*# read and clean data
d &lt;- read_csv('GEOSTAT_grid_POP_1K_2011_V2_0_1.csv') %&gt;%
  rbind(read_csv('JRC-GHSL_AIT-grid-POP_1K_2011.csv') %&gt;%
          mutate(TOT_P_CON_DT = '')) %&gt;%
  mutate(
    lat = as.numeric(gsub('.*N([0-9]+)[EW].*', '\\1', GRD_ID))/100,
    lng = as.numeric(gsub('.*[EW]([0-9]+)', '\\1', GRD_ID)) * ifelse(gsub('.*([EW]).*', '\\1', GRD_ID) == 'W', -1, 1) / 100
  ) %&gt;%
  filter(lng &gt; 25, lng &lt; 60) %&gt;%
  group_by(lat = round(lat, 1), lng = round(lng, 1)) %&gt;%
  summarize(value = sum(TOT_P, na.rm = T))  %&gt;%
  ungroup() %&gt;%
  tidyr::complete(lat, lng)

*# visualize
ggplot(d, aes(lng, lat + 5*(value / max(value, na.rm = T)))) +
  geom_line(
    aes(group = lat, text = paste("Population:", value)),
    size = 0.4, alpha = 0.8, color = '#5A3E37', na.rm = T
  )
```

---

```r
library(tidyverse)
*library(crosstalk)
*library(plotly)

d &lt;- read_csv('GEOSTAT_grid_POP_1K_2011_V2_0_1.csv') %&gt;%
  rbind(read_csv('JRC-GHSL_AIT-grid-POP_1K_2011.csv') %&gt;%
          mutate(TOT_P_CON_DT = '')) %&gt;%
  mutate(
    lat = as.numeric(gsub('.*N([0-9]+)[EW].*', '\\1', GRD_ID))/100,
    lng = as.numeric(gsub('.*[EW]([0-9]+)', '\\1', GRD_ID)) * ifelse(gsub('.*([EW]).*', '\\1', GRD_ID) == 'W', -1, 1) / 100
  ) %&gt;%
  filter(lng &gt; 25, lng &lt; 60) %&gt;%
  group_by(lat = round(lat, 1), lng = round(lng, 1)) %&gt;%
  summarize(value = sum(TOT_P, na.rm = T))  %&gt;%
  ungroup() %&gt;%
  tidyr::complete(lat, lng)

*# define latitude as "interaction unit"
*sd &lt;- SharedData$new(d, ~lat)

ggplot(sd, aes(lng, lat + 5*(value / max(value, na.rm = T)))) +
  geom_line(
    aes(group = lat, text = paste("Population:", value)),
    size = 0.4, alpha = 0.8, color = '#5A3E37', na.rm = T
  )
  
*ggplotly()
```

---

&lt;iframe src="../20170803/europe.html" width="100%" height="750" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;

---
background-image: url(../20171207/epl.png)
background-size: contain
class: inverse

---
background-image: url(../20171207/epl.png)
background-size: contain
class: middle

.pull-left[
# Neat, but I can't: 

&lt;div class="principles"&gt;
• Query different years &lt;br /&gt;
• Zoom/pan
&lt;/div&gt;
]

---
background-image: url(../20171207/epl.gif)
background-size: contain
class: middle, center 

---
background-image: url(../20171207/epl.gif)
background-size: contain

# Generally useful for comparing within &amp; across panel


---
## An example with Texas housing prices

```r
library(dplyr)
tx &lt;- txhousing %&gt;%
  select(city, year, month, median) %&gt;%
  filter(city %in% c("Galveston", "Midland", "Odessa", "South Padre Island"))
tx
```

```r
#&gt; # A tibble: 748 x 4
#&gt;         city  year month median
#&gt;        &lt;chr&gt; &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
#&gt;  1 Galveston  2000     1  95000
#&gt;  2 Galveston  2000     2 100000
#&gt;  3 Galveston  2000     3  98300
#&gt;  4 Galveston  2000     4 111100
#&gt;  5 Galveston  2000     5  89200
#&gt;  6 Galveston  2000     6 108600
#&gt;  7 Galveston  2000     7  99000
#&gt;  8 Galveston  2000     8  96200
#&gt;  9 Galveston  2000     9 104000
#&gt; 10 Galveston  2000    10 118800
#&gt; # ... with 738 more rows
```

---
### Compare within and across cities

```r
*TX &lt;- SharedData$new(tx, ~year)
p &lt;- ggplot(TX, aes(month, median, group = year)) + geom_line() +
  facet_wrap(~city, ncol = 2)
highlight(ggplotly(p), dynamic = T, persistent = T, selectize = T)
```

&lt;iframe src="../20171207/txhousing.html" width="100%" height="450" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;

---
## How to drain the swamp? &lt;div class="highlight"&gt; R 📦s that avoid &lt;/div&gt;

.pull-left[
## Exploratory

&lt;div class="principles"&gt;
• Start-up &lt;br/&gt;
• &lt;div class="highlight"&gt;Iteration quicksand&lt;/div&gt; &lt;br/&gt;
• Dead-end
&lt;/div&gt;
]

.pull-right[
## Expository

&lt;div class="principles"&gt;
• Deployment &lt;br/&gt;
• Latency
&lt;/div&gt;
]

&lt;br/&gt;

&lt;div class="highlight"&gt;
* Reduce distance between data and visuals
  * Leverage [grammar of graphics](https://www.amazon.com/Grammar-Graphics-Statistics-Computing/dp/0387245448) (e.g. **ggplot2**, **vega**, etc)
  * Leverage tidy data principles (e.g., **dplyr**, **tidyr**, **broom**, etc)
&lt;div&gt;

---
## Some motivation: query missing values by city

&lt;iframe src="../20171207/txhousing-missing.html" width="100%" height="500" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;

---
class: bottom, left 
background-image: url(../20171207/pipeline.svg)
background-size: contain

## The 'data pipeline'

---

## The implementation

```r
library(plotly)
library(crosstalk)

# define city as 'unit of interaction'
sd &lt;- SharedData$new(txhousing, ~city)

# initiate plot object, ensuring one mark per group
base &lt;- plot_ly(sd, color = I("black")) %&gt;%
  group_by(city)

# transform plot object as if it's a data frame
p1 &lt;- base %&gt;%
  summarise(miss = sum(is.na(median))) %&gt;%
  filter(miss &gt; 0) %&gt;%
  arrange(miss) %&gt;%
  add_bars(x = ~miss, y = ~factor(city, levels = city)) %&gt;%
  layout(barmode = "overlay")

p2 &lt;- add_lines(base, x = ~date, y = ~median, alpha = 0.3)

 subplot(p1, p2, titleX = TRUE, widths = c(0.3, 0.7)) %&gt;% 
  highlight(dynamic = TRUE, persistent = TRUE, selectize = TRUE)
```

---
## More motivation

1. US elections example
2. 


---
## How to drain the swamp? &lt;div class="highlight"&gt; R 📦s that avoid &lt;/div&gt;

.pull-left[
## Exploratory

&lt;div class="principles"&gt;
• Start-up &lt;br/&gt;
• Iteration&lt;br/&gt;
• Dead-end
&lt;/div&gt;
]

.pull-right[
## Expository

&lt;div class="principles"&gt;
&lt;div class="highlight"&gt; • Deployment quicksand &lt;/div&gt; &lt;br/&gt;
• Latency
&lt;/div&gt;
]

&lt;br/&gt;

&lt;div class="highlight"&gt;
Produce a standalone web page whenever possible
&lt;div&gt;

---
background-image: url(../20171207/server-client.svg)
background-size: contain

---
background-image: url(../20171207/server-client.svg)
background-size: contain
class: middle, center

# Standalone web pages are **much** easier to share, deploy, scale, and maintain.

---
class: middle, bottom
background-image: url(../20171207/pipeline.svg)
background-size: contain

# Where is the pipeline?

---
background-image: url(../20171207/crosstalk.svg)
background-size: contain

## The general model

.footnote[
### Links are specified in R, but the "updating logic" is JavaScript -- no server required!
]



---
## How to drain the swamp? &lt;div class="highlight"&gt; R 📦s that avoid &lt;/div&gt;

.pull-left[
## Exploratory

&lt;div class="principles"&gt;
• Start-up &lt;br/&gt;
• Iteration &lt;br/&gt;
• Dead-end
&lt;/div&gt;
]

.pull-right[
## Expository

&lt;div class="principles"&gt;
• Deployment &lt;br/&gt;
&lt;div class="highlight"&gt;• Latency quicksand&lt;/div&gt;
&lt;/div&gt;
]

&lt;br/&gt;

&lt;div class="highlight"&gt;
* User activity drops w/ delay of 500ms (&lt;a href="https://idl.cs.washington.edu/papers/latency/"&gt;Liu &amp; Heer 2014&lt;/a&gt;)
  * Support canvas-based (e.g. WebGL) as well as vector (e.g. SVG)
  * Provide API for modifying plots in R (&amp; JavaScript!)
&lt;div&gt;

---

## Base map layer does not require a redraw with a new fillcolor!

&lt;img src="http://i.imgur.com/PzDMqZ0.gif" /&gt;

---

### Leverage any [plotly.js function](https://plot.ly/javascript/plotlyjs-function-reference/) to *modify* a plot via `plotlyProxy()`

```r
library(shiny)
library(plotly)

ui &lt;- fluidPage(
  selectInput("color", "Canada's fillcolor", colors()),
  plotlyOutput("map")
)

server &lt;- function(input, output, session) {
  
  output$map &lt;- renderPlotly({
    map_data("world", "canada") %&gt;%
      group_by(group) %&gt;%
      plot_mapbox(x = ~long, y = ~lat, color = I("black")) %&gt;%
      add_polygons()
  })
  
  observeEvent(input$color, {
    plotlyProxy("map", session) %&gt;%
      plotlyProxyInvoke("restyle", list(fillcolor = toRGB(input$color)))
  })
}

shinyApp(ui, server)
```



---
## How to drain the swamp? &lt;div class="highlight"&gt; R 📦s that avoid &lt;/div&gt;

.pull-left[
## Exploratory

&lt;div class="principles"&gt;
• Start-up &lt;br/&gt;
• Iteration &lt;br/&gt;
&lt;div class="highlight"&gt;• Dead-end quicksand&lt;/div&gt;
&lt;/div&gt;
]

.pull-right[
## Expository

&lt;div class="principles"&gt;
• Deployment &lt;br/&gt;
• Latency
&lt;/div&gt;
]

&lt;br/&gt;

&lt;div class="highlight"&gt;
* Integrate with other libraries that complement yours
&lt;div&gt;


---
background-image: url(../20170803/plotlyLeaflet.gif)
background-size: contain

## plotly &amp; leaflet

---
background-image: url(../20171207/workflow2.svg)
background-size: 250px
background-position: 90% 8%
class: inverse, center, middle

### No matter how complex and polished the individual operations are, it is often 

# the quality of the glue that most directly determines the power of the system.

.footnote[
Quote from Hal Abelson -- part of the [tidyverse manifesto](https://cran.r-project.org/package=tidyverse)
]

---

```r
library(plotly)
library(leaflet)
library(crosstalk)

*# good glue requires uniform data structures
*sd &lt;- SharedData$new(quakes)

p &lt;- plot_ly(sd, x = ~depth, y = ~mag) %&gt;% 
  add_markers(alpha = 0.5) %&gt;%
  highlight("plotly_selected", dynamic = TRUE)

map &lt;- leaflet(sd) %&gt;% 
  addTiles() %&gt;% 
  addCircles()

bscols(widths = c(6, 6), p, map)
```


---
## How to drain the swamp? &lt;div class="highlight"&gt; R 📦s that avoid &lt;/div&gt;

.pull-left[
## Exploratory

&lt;div class="principles"&gt;
• Start-up &lt;br/&gt;
• Iteration &lt;br/&gt;
&lt;div class="highlight"&gt;• Dead-end quicksand&lt;/div&gt;
&lt;/div&gt;
]

.pull-right[
## Expository

&lt;div class="principles"&gt;
• Deployment &lt;br/&gt;
• Latency
&lt;/div&gt;
]

&lt;br/&gt;

&lt;div class="highlight"&gt;
* Every 📦 that reduces start-up/iteration will *always* have dead ends. 
* What you leave out is just as important as what you put in!
  * Ask yourself: can others do powerful things _quickly_? 
* Strive for 80/20 rule: 80% easy, other 20% possible
&lt;div&gt;

---

#### Provide tools for "power users"

```
plot_ly(mtcars, x = ~wt, y = ~mpg) %&gt;%
  add_markers(text = ~paste0("http://google.com/#q=", rownames(mtcars))) %&gt;%
  htmlwidgets::onRender("function(el, x) {
    el.on('plotly_click', function(d) {
      var pt = d.points[0];
      var url = pt.data.text[pt.pointNumber];
      window.open(url);
    });
  }")
```

&lt;iframe src="../20171207/onrender.html" width="100%" height="350" scrolling="no" seamless="seamless" frameBorder="0"&gt; &lt;/iframe&gt;


---
## How to drain the swamp? &lt;div class="highlight"&gt; R 📦s that avoid &lt;/div&gt;

.pull-left[
## Exploratory

&lt;div class="principles"&gt;
• Start-up &lt;br/&gt;
• Iteration &lt;br/&gt;
&lt;div class="highlight"&gt;• Dead-end quicksand&lt;/div&gt;
&lt;/div&gt;
]

.pull-right[
## Expository

&lt;div class="principles"&gt;
• Deployment &lt;br/&gt;
• Latency
&lt;/div&gt;
]

&lt;br/&gt;

&lt;div class="highlight"&gt;
* Interactive graphics software must be opinionated
  * Techniques should empower data analysis tasks ([Cook et al 1996](https://www.jstor.org/stable/1390754))
* Not enough statisticians influence design nowadays
  * We used to be more involved! &lt;http://stat-graphics.org/movies/&gt;
  * Tech landscape shifted from C/Java to JavaScript 
&lt;div&gt;

---
background-image: url(../20171207/taxonomy.svg)
background-size: contain
class: bottom, inverse

## Techniques that support data analysis [Cook et al 1996](https://www.jstor.org/stable/1390754)

---
background-image: url(../20171207/taxonomy2.svg)
background-size: contain
class: inverse

&lt;h3&gt;
&lt;div class="highlight"&gt; 
  What kind of visualizations should be possible/easy?
&lt;/div&gt;
&lt;/h3&gt;

---
background-image: url(../20171207/taxonomy3.svg)
background-size: contain
class: inverse

&lt;h3&gt;
&lt;div class="highlight"&gt; 
  How do we help users find the right view?
&lt;/div&gt;
&lt;/h3&gt;

---
background-image: url(../20171207/taxonomy4.svg)
background-size: contain
class: inverse

&lt;h3&gt;
&lt;div class="highlight"&gt; 
  How to best enable dynamic answers to (statistical) questions?
&lt;/div&gt;
&lt;/h3&gt;

---

## In summary

.pull-left[
## Exploratory quicksand

* Start-up
  * Build upon existing knowledge and tools
* Iteration
  * Reduce distance between data and visuals
  * Leverage grammar of graphics and tidy-data principles
* Dead-end
  * Integrate with other libraries that complement yours
  * Strive for 80/20 rule: 80% easy, other 20% possible
  * Interactive techniques should empower data analysis tasks
]

.pull-right[
## Expository quicksand

* Deployment
  * Use standalone web pages whenever possible
* Latency
  * User activity drops w/ delay of 500ms
]

---
class: middle, center

## Thanks! Questions?

Slides: &lt;https://talks.cpsievert.me&gt; &lt;br /&gt;

#### Contact

<i class="fa  fa-twitter "></i> &lt;a href='https://twitter.com/cpsievert'&gt;@cpsievert&lt;/a&gt; &lt;br /&gt;
<i class="fa  fa-github "></i> &lt;a href='https://github.com/cpsievert'&gt;@cpsievert&lt;/a&gt; &lt;br /&gt;
<i class="fa  fa-envelope "></i> &lt;cpsievert1@gmail.com&gt; &lt;br /&gt;
<i class="fa  fa-globe "></i> &lt;https://cpsievert.me/&gt;
    </textarea>
<script src="../templates/remarkjs/libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "14.6:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {window.dispatchEvent(new Event('resize'));});
(function() {var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler"); if (!r) return; s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }"; d.head.appendChild(s);})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
